<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">Novo Pedido</h1>
    <a class="btn btn-outline-secondary" routerLink="/pedidos">Voltar</a>
  </div>

  <div class="card">
    <div class="card-body">
      <form [formGroup]="form" (ngSubmit)="submit()">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Cliente</label>
            <select class="form-select" formControlName="clientId">
              <option value="">Selecione um cliente</option>
              <option *ngFor="let client of clients" [value]="client.id">
                {{ client.razaoSocial }}
              </option>
            </select>
          </div>
          <div class="col-12">
            <label class="form-label">Produtos</label>
            <div class="row g-2 align-items-end">
              <div class="col-md-6">
                <select class="form-select" formControlName="productId">
                  <option value="">Selecione um produto</option>
                  <option *ngFor="let product of products" [value]="product.id">
                    {{ product.descricao }}
                  </option>
                </select>
              </div>
              <div class="col-md-2">
                <input class="form-control" type="number" placeholder="Qtd" formControlName="quantity">
              </div>
              <div class="col-md-2">
                <button class="btn btn-outline-primary w-100" type="button" (click)="addItem()">Adicionar</button>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <h2 class="h6">Itens do Pedido</h2>
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Produto</th>
                  <th>Quantidade</th>
                  <th class="text-end">Acoes</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of items; let i = index">
                  <td>{{ item.descricao }}</td>
                  <td>{{ item.quantity }}</td>
                  <td class="text-end">
                    <button class="btn btn-sm btn-outline-danger" type="button" (click)="removeItem(i)">Remover</button>
                  </td>
                </tr>
                <tr *ngIf="items.length === 0">
                  <td colspan="3">Nenhum item adicionado.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="mt-3" *ngIf="error">
          <div class="alert alert-danger py-2">{{ error }}</div>
        </div>

        <div class="mt-3">
          <button class="btn btn-primary" [disabled]="loading || items.length === 0 || form.controls.clientId.invalid">
            {{ loading ? 'Salvando...' : 'Salvar Pedido' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
